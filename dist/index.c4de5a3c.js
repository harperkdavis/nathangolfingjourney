let game={username:void 0,connected:!1,started:!1,socket:void 0,id:void 0,levels:void 0,world:void 0,selfBall:void 0,worldUpdateTime:0,prevWorld:void 0,chat:[],chatting:!1,input:{}},temp={},assets={font:void 0,sfx:{}};const constant={adjectives:["fortunate","bewildering","long","merciless","determined","painless","long long long","cautious","depressing","thoughtful","courageous","optimistic","exuberant","difficult","confusing","quick","cheerful","hopeless","glorious","short","charming","confusing","lonely","unknown","painful","unfortunate","infinite","difficult","comfortable","dull","elegant","perfect"]};let SCALE=1,OFFSET_X=0,OFFSET_Y=0;function preload(){assets.font=loadFont("static/koubit_001.ttf"),assets.sfx.complete=loadSound("static/sfx/complete.wav"),assets.sfx.hit=loadSound("static/sfx/hit.wav"),assets.sfx.land=loadSound("static/sfx/land.wav"),assets.sfx.pass=loadSound("static/sfx/pass.wav"),assets.sfx.reset=loadSound("static/sfx/reset.wav"),assets.sfx.score=loadSound("static/sfx/score.wav")}async function setup(){textFont(assets.font),createCanvas(1,1),windowResized()}function isLoggedIn(){return!!localStorage.getItem("nathan_golfing_journey_id")}function getAdjective(){let e=localStorage.getItem("nathan_golfing_journey_adjective");if(null!=e)return constant.adjectives[parseInt(e)]}async function connectNew(e){let t=await axios.post("/nathangolfingjourney/new_ball",{username:e}).then((e=>e.data));if(!t.success)return temp.usernameFailReason=t.error||"unknown error",void(temp.attemptingToSignUp=!1);localStorage.setItem("nathan_golfing_journey_id",t.id)}async function connect(){return!!localStorage.getItem("nathan_golfing_journey_id")&&(id=localStorage.getItem("nathan_golfing_journey_id"),game.levels=[],game.chat=[],game.world={},game.prevWorld={},temp.played={},game.input={aiming:!1,aimX:0,aimY:0,aimVelX:0,aimVelY:0,aimPower:0},game.socket=io({query:"id="+id,path:"/nathangolfingjourney/socket.io"}),game.socket.on("accept",(e=>{e.success?(game.username=e.username,game.connected=!0):temp.connectionError=e.error})),game.socket.on("levels",(e=>{game.levels=e.levels})),game.socket.on("world",(e=>{game.prevWorld={...game.world},game.world=e,game.worldUpdateTime=Date.now(),temp.played={},game.world.balls[id]&&game.world.balls[id].ball&&(game.selfBall=game.world.balls[id].ball),game.chat=game.chat.filter((e=>e.tick>game.world.tick-200))})),game.socket.on("chat",(e=>{game.chat.unshift(e)})),game.socket.on("reload",(async e=>{game.socket.disconnect(),await connect()})),!0)}function windowResized(){resizeCanvas(windowWidth,windowHeight),SCALE=min(width/200,height/100),OFFSET_X=100*max(0,width/200-height/100),OFFSET_Y=50*max(0,height/100-width/200)}function keyTyped(){game.started?game.chatting&&temp.typing.length<63&&"Enter"!=key&&(temp.typing+=key):getAdjective()&&(null==temp.usernameTyped&&(temp.usernameTyped=""),"Enter"!=key&&temp.usernameTyped.length<=16&&(temp.usernameTyped+=key))}function keyPressed(){if(game.started)keyCode==ESCAPE&&(game.chatting=!1,temp.typing=""),keyCode==ENTER&&(game.chatting?(game.chatting=!1,temp.typing.trim().length>0&&game.socket.emit("chat_request",{message:temp.typing})):(game.chatting=!0,temp.typing="")),keyCode==BACKSPACE&&game.chatting&&temp.typing.length>0&&(temp.typing=temp.typing.substring(0,temp.typing.length-1));else if(getAdjective()&&(null==temp.usernameTyped&&(temp.usernameTyped=""),keyCode==BACKSPACE&&temp.usernameTyped.length>0&&(temp.usernameTyped=temp.usernameTyped.substring(0,temp.usernameTyped.length-1)),keyCode==ENTER&&!temp.attemptingToSignUp)){let e=temp.usernameTyped.trim();e.length>0&&(temp.attemptingToSignUp=!0,connectNew(e))}}function mousePressed(){userStartAudio(),game.started&&(game.input.aiming=!0,game.input.aimX=(mouseX-OFFSET_X)/SCALE,game.input.aimY=(mouseY-OFFSET_Y)/SCALE)}function mouseReleased(){game.started&&(game.input.aiming&&(game.socket.emit("stroke",game.input),assets.sfx.hit.play()),game.input.aiming=!1)}function update(){if(game.input.aiming){let e=(mouseX-OFFSET_X)/SCALE,t=(mouseY-OFFSET_Y)/SCALE,l=sqrt(pow(game.input.aimX-e,2)+pow(game.input.aimY-t,2));game.input.aimVelX=l>0?(e-game.input.aimX)/l:0,game.input.aimVelY=l>0?(t-game.input.aimY)/l:0,game.input.aimPower=min(pow(l/40,1),1),game.socket.emit("aim_input",game.input)}game.selfBall&&(game.selfBall.wasReset&&(temp.played.reset||(temp.played.reset=!0,assets.sfx.reset.stop(),assets.sfx.reset.play())),39==game.selfBall.trans?temp.played.complete||(temp.played.complete=!0,assets.sfx.complete.stop(),assets.sfx.complete.play()):1==game.selfBall.trans&&(temp.played.pass||(temp.played.pass=!0,assets.sfx.pass.stop(),assets.sfx.pass.play())))}function drawLevel(e,t){let l=[];colorMode(HSB,255),fill(e.id/1e4*1e3%255,lerp(0,255,min((5e3-Math.abs(e.id-5e3))/4e3,1)),200),colorMode(RGB,255),noStroke(),beginShape();for(let a of e.points)vertex((a.x+t)*SCALE,a.y*SCALE),a.y>99&&l.push(a.x+t);vertex((e.width+t)*SCALE,1e3*SCALE),vertex(t*SCALE,1e3*SCALE),endShape(CLOSE),stroke(0),noFill(),beginShape();for(let l of e.points)vertex((l.x+t)*SCALE,l.y*SCALE);endShape(),fill(50,150,230);for(let e=0;e<l.length/2+1;e+=2){let t=l[e],a=l[e+1];rect(t*SCALE,98*SCALE,(a-t)*SCALE,1e3*SCALE)}}function drawLevelFlag(e,t){if(game.selfBall&&game.selfBall.level+1==e.id){textSize(4*SCALE),textAlign(LEFT,TOP);let l=textWidth(e.id);stroke(0),fill(250,250,200),beginShape(),vertex((e.holeX+t+1.83)*SCALE,(e.holeY-5)*SCALE),vertex((e.holeX+t+2.5)*SCALE+l,(e.holeY-5)*SCALE),vertex((e.holeX+t+3)*SCALE+l,(e.holeY-4)*SCALE),vertex((e.holeX+t+2.5)*SCALE+l,(e.holeY-3)*SCALE),vertex((e.holeX+t+1.83)*SCALE,(e.holeY-3)*SCALE),endShape(),noStroke(),fill(100),text(e.id,(e.holeX+t+2.5)*SCALE,(e.holeY-6)*SCALE),stroke(0),fill(150),rect((e.holeX+t+1.33)*SCALE,(e.holeY-5)*SCALE,.5*SCALE,5*SCALE)}}function drawLevelStats(e,t){if(game.selfBall&&game.selfBall.level==e.id&&e.stats){let l=e.holeY+5,a=e.holeX+t;e.holeY>50&&(l=e.holeY+5),noStroke(),fill(0),textSize(3*SCALE),textAlign(LEFT,TOP),text("strokes",a*SCALE,l*SCALE),text("time",(a+30)*SCALE,l*SCALE),console.log(e.stats.sortedByTime);for(let t=0;t<10;t++){let i=e.stats.sortedByScore[t];if(i&&game.world.balls[i]){let o=game.world.balls[i].ball;fill(o.color[0],o.color[1],o.color[2]),text("#"+(t+1)+" - "+o.clears[Math.floor(e.id/100)-1][0]+" - "+o.name,a*SCALE,(l+1.5*(t+1)+1)*SCALE)}let o=e.stats.sortedByTime[t];if(o&&game.world.balls[o]){let i=game.world.balls[o].ball,m=i.clears[Math.floor(e.id/100)-1][1],s=floor(m)%60,n=floor(m/60)%60,r=floor(m/3600)%60;fill(i.color[0],i.color[1],i.color[2]),text("#"+(t+1)+" - "+r+"h "+n+"m "+s+"s - "+i.name,(a+30)*SCALE,(l+1.5*(t+1)+1)*SCALE)}}let o=e.stats.sortedByScore.indexOf(game.selfBall.id);if(o>=10&&(fill(game.selfBall.color[0],game.selfBall.color[1],game.selfBall.color[2]),text("#"+(o+1)+" - "+game.selfBall.clears[Math.floor(e.id/100)-1][0]+" - "+game.selfBall.name,a*SCALE,(l+18)*SCALE)),e.stats.sortedByTime.indexOf(game.selfBall.id)>=10){let t=game.selfBall.clears[Math.floor(e.id/100)-1][1],o=floor(t)%60,m=floor(t/60)%60,s=floor(t/3600)%60;fill(game.selfBall.color[0],game.selfBall.color[1],game.selfBall.color[2]),text("#"+(i+1)+" - "+s+"h "+m+"m "+o+"s - "+ball.name,(a+30)*SCALE,(l+1.5*(i+1)+1)*SCALE)}}}function drawAim(e,t=[0,0,0],l=1){stroke(t[0],t[1],t[2],min(2e3*e.aimPower,255*l)),noFill();let a=min(60*e.aimPower,3);ellipse(e.aimX*SCALE,e.aimY*SCALE,a*SCALE,a*SCALE),line((e.aimX-1.5*e.aimVelX)*SCALE,(e.aimY-1.5*e.aimVelY)*SCALE,(e.aimX-e.aimVelX*max(40*e.aimPower,1.5))*SCALE,(e.aimY-e.aimVelY*max(40*e.aimPower,1.5))*SCALE),stroke(t[0],t[1],t[2],min(2e3*e.aimPower,100*l)),line((e.aimX+1.5*e.aimVelX)*SCALE,(e.aimY+1.5*e.aimVelY)*SCALE,(e.aimX+e.aimVelX*max(40*e.aimPower,1.5))*SCALE,(e.aimY+e.aimVelY*max(40*e.aimPower,1.5))*SCALE),line((e.aimX+e.aimVelY+e.aimVelX*max(40*e.aimPower,1.5))*SCALE,(e.aimY-e.aimVelX+e.aimVelY*max(40*e.aimPower,1.5))*SCALE,(e.aimX-e.aimVelY+e.aimVelX*max(40*e.aimPower,1.5))*SCALE,(e.aimY+e.aimVelX+e.aimVelY*max(40*e.aimPower,1.5))*SCALE),noStroke(),fill(t[0],t[1],t[2],min(3e3*e.aimPower,255*l)),triangle((e.aimX-e.aimVelX*max(40*e.aimPower,1.5))*SCALE,(e.aimY-e.aimVelY*max(40*e.aimPower,1.5))*SCALE,(e.aimX+.5*e.aimVelY+1.5*e.aimVelX-e.aimVelX*max(40*e.aimPower,1.5))*SCALE,(e.aimY-.5*e.aimVelX+1.5*e.aimVelY-e.aimVelY*max(40*e.aimPower,1.5))*SCALE,(e.aimX-.5*e.aimVelY+1.5*e.aimVelX-e.aimVelX*max(40*e.aimPower,1.5))*SCALE,(e.aimY+.5*e.aimVelX+1.5*e.aimVelY-e.aimVelY*max(40*e.aimPower,1.5))*SCALE)}function draw(){if(game.started){if(update(),background(250),push(),translate(OFFSET_X,OFFSET_Y),null!=game.world&&null!=game.prevWorld){let e=(Date.now()-game.worldUpdateTime)/50;if(game.selfBall){let t=game.prevWorld.balls[game.selfBall.id],l=game.world.balls[game.selfBall.id];if(l&&t){let a=t.ball.trans,i=l.ball.trans,o=i>a?i:lerp(a,i,e);game.selfBall.trans>=0&&translate(-game.levels[1].width*((40-o)/40)*SCALE,0)}}if(game.levels){let e=20-game.levels[0].width;for(let t=0;t<4;t++)drawLevelFlag(game.levels[t],e),e+=game.levels[t].width}temp.offlineBalls=[0,0,0,0],push(),translate((20-game.levels[1].x)*SCALE,0);for(let e of game.world.sortedBalls){let t=game.world.balls[e];if(!t.online&&game.selfBall){let e=t.ball;if(e.level>=game.selfBall.level&&e.level<=game.selfBall.level+2){stroke(0),fill(255);let t=e.level-game.selfBall.level;if(temp.offlineBalls[t]<=10){let l=game.levels[t],a=l.x+l.holeX,i=l.holeY-2*temp.offlineBalls[t]-5,o=e.name+" ("+e.score+")";textSize(3*SCALE),textAlign(LEFT,CENTER),rect((a-1)*SCALE,(i-3)*SCALE,2*SCALE+textWidth(o),2*SCALE),noStroke(),fill(e.color[0],e.color[1],e.color[2]),text(o,a*SCALE,(i-2.5)*SCALE),temp.offlineBalls[t]+=1}}}}for(let t of game.world.sortedBalls){let l=game.world.balls[t],a=game.prevWorld.balls[t];if(l&&a&&l.online){let t=a.ball,i=l.ball,o={x:lerp(t.x,i.x,e),y:lerp(t.y,i.y,e)},m=lerp(t.rotation,i.rotation,e);if(stroke(0),fill(i.color[0],i.color[1],i.color[2]),arc(o.x*SCALE,o.y*SCALE,1*SCALE,1*SCALE,m,m+PI),fill(.8*i.color[0],.8*i.color[1],.8*i.color[2]),arc(o.x*SCALE,o.y*SCALE,1*SCALE,1*SCALE,m+PI,m+TWO_PI),noStroke(),textSize(32),textAlign(CENTER,BOTTOM),text(i.name,o.x*SCALE,(o.y-2)*SCALE),game.selfBall&&i.id==game.selfBall.id)stroke(0),noFill(),triangle(o.x*SCALE,(o.y-1)*SCALE,(o.x-.5)*SCALE,(o.y-1.5)*SCALE,(o.x+.5)*SCALE,(o.y-1.5)*SCALE);else if(i.aiming){drawAim({aimX:i.aimX,aimY:i.aimY,aimVelX:lerp(t.aimVelX,i.aimVelX,e),aimVelY:lerp(t.aimVelY,i.aimVelY,e),aimPower:lerp(t.aimPower,i.aimPower,e)},i.color,.5)}}}}if(pop(),game.levels){let e=20-game.levels[0].width;for(let t=0;t<4;t++)drawLevel(game.levels[t],e),e+=game.levels[t].width;e=20-game.levels[0].width;for(let t=0;t<4;t++)drawLevelStats(game.levels[t],e),e+=game.levels[t].width}if(game.input.aiming&&game.selfBall&&drawAim(game.input,[0,0,0],game.selfBall.canStroke&&game.selfBall.trans<0?1:.4),pop(),game.selfBall){let e=game.world.sortedBalls.indexOf(game.selfBall.id);if(textAlign(CENTER,TOP),fill(51),textSize(64),fill(game.selfBall.color[0],game.selfBall.color[1],game.selfBall.color[2]),text(game.selfBall.name,width/2,-8),textSize(32),fill(51),text(game.selfBall.score+" (avg "+nf(game.selfBall.score/max(game.selfBall.level,1),0,2)+")",width/2,32),text(game.selfBall.level+" / 10000 (#"+(e+1)+")",width/2,48),game.selfBall.trans>0){let e=floor(game.selfBall.time)%60,t=floor(game.selfBall.time/60)%60,l=floor(game.selfBall.time/3600)%60;text(l+"h "+t+"m "+e+"s",width/2,64)}textSize(32);let t=[],l=[],a=[];for(let l=0;l<5;l++){let a=game.world.sortedBalls[l];a&&l<e&&t.push(a)}for(let a=1;a<=5;a++){let i=game.world.sortedBalls[e-a];i&&!t.includes(i)&&l.push(i)}for(let t=1;t<=10;t++){let l=game.world.sortedBalls[e+t];l&&a.push(l)}textSize(32),textAlign(RIGHT,CENTER);let i=0;for(let e of t.concat(l.reverse())){let l=game.world.balls[e].ball;fill(250);let a="#"+(game.world.sortedBalls.indexOf(e)+1)+" "+l.name+" ("+l.level+"/"+l.score+")",o=textWidth(a);stroke(0);let m=t.includes(e)?0:10;beginShape(),vertex(width-15,m+5+20*i),vertex(width-5,m+15+20*i),vertex(width-15,m+25+20*i),vertex(width-25-o,m+25+20*i),vertex(width-25-o,m+5+20*i),endShape(CLOSE),noStroke(),fill(l.color[0],l.color[1],l.color[2]),text(a,width-15,m+10+20*i),i++}i=0,textAlign(LEFT,CENTER);for(let e of a){let t=game.world.balls[e].ball;fill(250);let l="#"+(game.world.sortedBalls.indexOf(e)+1)+" "+t.name+" ("+t.level+"/"+t.score+")",a=textWidth(l);stroke(0),beginShape(),vertex(15,5+20*i),vertex(5,15+20*i),vertex(15,25+20*i),vertex(25+a,25+20*i),vertex(25+a,5+20*i),endShape(CLOSE),noStroke(),fill(t.color[0],t.color[1],t.color[2]),text(l,15,10+20*i),i++}}if(game.chat){let e=0;fill(0,100),rect(0,height-20-15*game.chat.length,800,15*game.chat.length),textAlign(LEFT,BOTTOM),textSize(32);for(let t of game.chat)fill(t.color[0],t.color[1],t.color[2]),text(t.message,5,height-20-15*e),e++;game.chatting&&(fill(51),text(temp.typing+(Math.floor(millis()/500)%2==0?"_":""),5,height-5))}}else if(background(0),noStroke(),fill(255),textSize(32),textAlign(CENTER,TOP),text("Nathan Golfing 2:",width/2,height/2-150),textSize(64),text("Journey",width/2,height/2-140),isLoggedIn())game.connected?(textSize(32),text("This is the "+getAdjective()+" journey of",width/2,height/2-80),textSize(64),game.selfBall?fill(game.selfBall.color[0],game.selfBall.color[1],game.selfBall.color[2]):fill(255),text(game.username,width/2,height/2-70),fill(255),rect(width/2-50,height/2+10,100,20),textSize(32),fill(0),text("play",width/2,height/2+4),mouseIsPressed&&isWithin(mouseX,mouseY,width/2-50,height/2+10,100,20)&&(game.started=!0)):(temp.attemptedToConnect||(connect(),temp.attemptedToConnect=!0),textSize(32),text("Loading...",width/2,height/2),temp.connectionError&&(fill(255,0,0),text(temp.connectionError,width/2,height/2+40)));else{if(textSize(32),!getAdjective())return text("describe your journey:",width/2,height/2-80),null==temp.adjectiveChoice&&(temp.adjectiveChoice=floor(random(0,constant.adjectives.length))),temp.adjective=constant.adjectives[temp.adjectiveChoice],text(temp.adjective,width/2,height/2-50),triangle(width/2+10,height/2-15,width/2+20,height/2-10,width/2+10,height/2-5),triangle(width/2-20,height/2-15,width/2-10,height/2-15,width/2-15,height/2-5),void(mouseIsPressed&&(isWithin(mouseX,mouseY,width/2+10,height/2-15,10,10)?(temp.adjectiveChoice+=1,temp.adjectiveChoice>=constant.adjectives.length&&(temp.adjectiveChoice=0)):isWithin(mouseX,mouseY,width/2-20,height/2-15,10,10)&&localStorage.setItem("nathan_golfing_journey_adjective",temp.adjectiveChoice)));text("This is the "+getAdjective()+" journey of: ",width/2,height/2-80),null==temp.usernameTyped&&(temp.usernameTyped=""),temp.usernameFailReason&&(fill(255,0,0),text(temp.usernameFailReason,width/2,height/2+40)),fill(255),textSize(64),text(temp.usernameTyped+"_",width/2,height/2)}}
//# sourceMappingURL=index.c4de5a3c.js.map
